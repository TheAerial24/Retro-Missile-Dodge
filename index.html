<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plane Dodging Missiles (8-bit)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    canvas {
      image-rendering: pixelated;
      border: 4px solid #222;
      background: #000;
      box-shadow: 0 0 32px #111;
    }
    #overlay, #endScreen {
      position: absolute;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.9);
      z-index: 20;
      font-family: monospace;
      color: #fff;
    }
    #endScreen { display: none; }
    .panel {
      background: #111;
      border: 2px solid #333;
      padding: 20px;
      text-align: center;
      box-shadow: 0 0 24px #000;
    }
    .title {
      font-size: 20px;
      color: #00d0ff;
      margin-bottom: 12px;
    }
    .btn {
      margin-top: 12px;
      font-family: monospace;
      font-size: 14px;
      padding: 8px 16px;
      background: #1a1a1a;
      color: #fff;
      border: 2px solid #444;
      cursor: pointer;
    }
    .btn:hover { border-color: #00d0ff; color: #00d0ff; }
  </style>
</head>
<body>
  <!-- Start screen -->
  <div id="overlay">
    <div class="panel">
      <div class="title">PLANE DODGER</div>
      <div>Move: ← → &nbsp; | &nbsp; Shoot: Space</div>
      <button id="startBtn" class="btn">Start Game</button>
    </div>
  </div>

  <!-- End screen -->
  <div id="endScreen">
    <div class="panel">
      <div id="endScore" style="margin-bottom:12px;"></div>
      <button id="restartBtn" class="btn">Restart</button>
    </div>
  </div>

  <canvas id="game" width="320" height="480"></canvas>

<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const W=canvas.width,H=canvas.height;

const COLORS={plane:['#e0e0e0','#0077ff','#ff0000'],missile:['#ff2222','#cccccc','#222222'],bullet:'#ffff88'};

let started=false,gameOver=false;
let frame=0,score=0,lives=3;
let highScore=Number(localStorage.getItem('highScore')||0);

const plane={x:W/2,y:H-60,w:24,h:20,speed:3.8,vx:0,angle:0,invincible:0,doubleShot:0,
  draw(){ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.angle);
    if(this.invincible>0) ctx.globalAlpha=0.6;
    ctx.fillStyle=COLORS.plane[0];ctx.fillRect(-4,-8,8,16);
    ctx.fillStyle=COLORS.plane[1];ctx.fillRect(-12,2,24,4);
    ctx.fillStyle=COLORS.plane[2];ctx.fillRect(-2,-14,4,6);
    ctx.restore();ctx.globalAlpha=1;}
};

const bullets=[];let bulletCooldown=0;let bulletCooldownMax=12;
function makeBullet(x,y){return{x,y,vx:0,vy:-6.5,w:2,h:6,draw(){ctx.fillStyle=COLORS.bullet;ctx.fillRect(this.x-this.w/2,this.y-this.h/2,this.w,this.h);}};}
function shoot(){if(bulletCooldown<=0&&!gameOver){if(plane.doubleShot>0){bullets.push(makeBullet(plane.x-6,plane.y-14));bullets.push(makeBullet(plane.x+6,plane.y-14));}else bullets.push(makeBullet(plane.x,plane.y-14));bulletCooldown=bulletCooldownMax;}}

const missiles=[];
function spawnMissile(){const r=Math.random();const side=r<0.34?'left':(r<0.67?'right':'rear');let m={w:8,h:20,homing:true};
  if(side==='left'){m.x=-30;m.y=40+Math.random()*(H-120);m.vx=3.5+Math.random()*1.5;m.vy=(Math.random()-0.2)*1.5;}
  else if(side==='right'){m.x=W+30;m.y=40+Math.random()*(H-120);m.vx=-3.5-Math.random()*1.5;m.vy=(Math.random()-0.2)*1.5;}
  else{m.x=24+Math.random()*(W-48);m.y=-40;m.vx=(Math.random()-0.5)*1.2;m.vy=3.8+Math.random()*1.7;}
  m.speed=Math.hypot(m.vx,m.vy);m.angle=Math.atan2(m.vy,m.vx);
  m.homingStrength=0.02+Math.random()*0.03+frame/50000;
  m.draw=function(){ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.angle+Math.PI/2);
    ctx.fillStyle=COLORS.missile[1];ctx.fillRect(-4,-8,8,16);
    ctx.fillStyle=COLORS.missile[0];ctx.fillRect(-2,-14,4,6);
    ctx.fillStyle=COLORS.missile[2];ctx.fillRect(-1,-16,2,2);
    ctx.restore();};
  missiles.push(m);}

const particles=[];
function spawnExplosion(x,y,color='#ffcc44'){for(let i=0;i<8;i++){const a=Math.random()*Math.PI*2;const s=1+Math.random()*2.5;particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:30+Math.random()*20,draw(){ctx.fillStyle=color;ctx.fillRect(this.x-1,this.y-1,2,2);}});}}

const powerUps=[];
function spawnPowerUp(x,y){const types=['shield','rapid','double'];const type=types[Math.floor(Math.random()*types.length)];powerUps.push({x,y,type,w:12,h:12,life:600});}
function drawPowerUps(){for(let i=powerUps.length-1;i>=0;i--){const p=powerUps[i];ctx.fillStyle=p.type==='shield'?'#44f':(p.type==='rapid'?'#4f4':'#ff4');ctx.fillRect(p.x-6,p.y-6,12,12);p.y+=1;p.life--;if(p.life<=0){powerUps.splice(i,1);continue;}if(Math.abs(p.x-plane.x)<14&&Math.abs(p.y-plane.y)<14){if(p.type==='shield') plane.invincible=300;if(p.type==='rapid') bulletCooldownMax=6;if(p.type==='double') plane.doubleShot=600;powerUps.splice(i,1);}}}

const stars=Array.from({length:80},()=>({x:Math.random()*W,y:Math.random()*H,s:Math.random()*2+1}));
function drawBackground(){ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);ctx.fillStyle='#fff';for(let star of stars){ctx.fillRect(star.x,star.y,star.s,star.s);star.y+=star.s*0.5;if(star.y>H){star.y=0;star.x=Math.random()*W;}}}

// HUD drawn inside canvas
function drawHUD(){
  ctx.fillStyle='#111';ctx.fillRect(8,8,120,40);
  ctx.strokeStyle='#444';ctx.strokeRect(8,8,120,40);
  ctx.fillStyle='#fff';ctx.font='12px monospace';ctx.fillText('Score: '+score,14,22);
  ctx.fillStyle='red';ctx.fillText('♥'.repeat(lives),14,36);
  ctx.fillStyle='#333';ctx.fillRect(70,28,50,8);
  let ammoRatio=1-(bulletCooldown/bulletCooldownMax);
  ctx.fillStyle='#ff0';ctx.fillRect(70,28,50*ammoRatio,8);
  ctx.strokeStyle='#666';ctx.strokeRect(70,28,50,8);
}

let left=false,right=false,shooting
