<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dodging Missiles</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<style>
body { margin:0; background:#87CEEB; display:flex; align-items:center; justify-content:center; height:100vh; overflow:hidden; }
canvas { image-rendering: pixelated; border:4px solid #222; box-shadow:0 0 32px #111; background:#87CEEB; }
</style>
</head>
<body>
<canvas id="game" width="320" height="480"></canvas>
<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const W=canvas.width,H=canvas.height;

// Colors
const COLORS={
  plane:['#555','#888','#aaa'], // body, wings, cockpit
  missile:['#ff2222','#cccccc','#222222'],
  bullet:'#ffff88',
  cloud:'#fff',
  heart:'#ff4444',
  ammo:'#ffff88'
};

// Game state
let score=0,health=5,maxHealth=5;
let ammo=75,maxAmmo=75,reloadCooldown=0,reloadTime=120; // 2 seconds
let reloading=false;

// Plane
const plane={x:W/2,y:H-60,w:24,h:20,speed:3.8,vx:0,angle:0,draw(){
  ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.angle);
  ctx.fillStyle=COLORS.plane[0]; ctx.fillRect(-4,-8,8,16); // body
  ctx.fillStyle=COLORS.plane[1]; ctx.fillRect(-12,2,24,4);  // wings
  ctx.fillStyle=COLORS.plane[2]; ctx.fillRect(-2,-14,4,6);  // cockpit
  ctx.restore();
}};

// Bullets
const bullets=[]; let bulletCooldown=0; const bulletCooldownMax=12;
function shoot(){
  if(bulletCooldown<=0 && ammo>0 && !reloading){
    bullets.push({x:plane.x,y:plane.y-14,vx:0,vy:-6.5,w:2,h:6,draw(){ctx.fillStyle=COLORS.bullet;ctx.fillRect(this.x-this.w/2,this.y-this.h/2,this.w,this.h);}});
    bulletCooldown=bulletCooldownMax; ammo--;
    if(ammo<=0){ reloading=true; reloadCooldown=0;}
  }
}

// Missiles
const missiles=[];
function spawnMissile(){
  let m={w:8,h:20};
  m.x=20+Math.random()*(W-40); m.y=-20; 
  m.vx=(Math.random()-0.5)*1.2; m.vy=2+Math.random()*1.5;
  m.speed=Math.hypot(m.vx,m.vy); m.angle=Math.atan2(m.vy,m.vx);
  m.homingStrength=0.02+Math.random()*0.02;
  m.draw=function(){ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.angle+Math.PI/2);ctx.fillStyle=COLORS.missile[1];ctx.fillRect(-4,-8,8,16);ctx.fillStyle=COLORS.missile[0];ctx.fillRect(-2,-14,4,6);ctx.fillStyle=COLORS.missile[2];ctx.fillRect(-1,-16,2,2);ctx.restore();}
  missiles.push(m);
}

// Particles
const particles=[];
function spawnExplosion(x,y,color='#ffcc44'){ 
  for(let i=0;i<8;i++){ 
    const angle=Math.random()*Math.PI*2; 
    const speed=1+Math.random()*2; 
    particles.push({x,y,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,life:30+Math.random()*20,draw(){ctx.fillStyle=color;ctx.fillRect(this.x-1,this.y-1,2,2);}}); 
  }
}

// Clouds
const clouds=[];
for(let i=0;i<15;i++){ clouds.push({x:Math.random()*W,y:Math.random()*H/2,w:40+Math.random()*30,h:20+Math.random()*10});}
function drawBackground(){ 
  ctx.fillStyle='#87CEEB'; ctx.fillRect(0,0,W,H); 
  ctx.fillStyle=COLORS.cloud; 
  clouds.forEach(c=>{c.y+=0.3;if(c.y>H)c.y=-c.h;ctx.fillRect(c.x,c.y,c.w,c.h);});
}

// Controls
let left=false,right=false,shooting=false;
window.addEventListener('keydown',e=>{ if(e.key==='ArrowLeft') left=true; if(e.key==='ArrowRight') right=true; if(e.code==='Space'){shooting=true;shoot();}});
window.addEventListener('keyup',e=>{ if(e.key==='ArrowLeft') left=false; if(e.key==='ArrowRight') right=false; if(e.code==='Space') shooting=false;});

let frame=0;

// HUD
function drawHUD(){
  // Score
  ctx.fillStyle='#fff'; ctx.font='14px monospace'; ctx.textAlign='left'; ctx.fillText('Score: '+score,10,16);

  // Hearts
  for(let i=0;i<maxHealth;i++){
    const x=10+i*14, y=30;
    ctx.fillStyle=(i<health)?COLORS.heart:'#555';
    ctx.fillRect(x,y,12,12);
  }

  // Ammo bar (bottom of plane)
  const barWidth=75,barHeight=8;
  const x=plane.x-barWidth/2, y=plane.y+plane.h+10;
  ctx.fillStyle='#555'; ctx.fillRect(x,y,barWidth,barHeight);
  ctx.fillStyle=COLORS.ammo; ctx.fillRect(x,y,barWidth*(ammo/maxAmmo),barHeight);
}

function loop(){
  frame++;
  drawBackground();

  // Plane
  plane.vx=0; if(left) plane.vx=-plane.speed; if(right) plane.vx=plane.speed;
  plane.x+=plane.vx; plane.x=Math.max(20,Math.min(W-20,plane.x));
  const targetAngle=plane.vx*0.08; plane.angle+=(targetAngle-plane.angle)*0.12;
  plane.draw();

  if(bulletCooldown>0) bulletCooldown--; 
  if(shooting && bulletCooldown<=0) shoot();

  if(reloading){
    reloadCooldown++;
    if(reloadCooldown>=reloadTime){ ammo=maxAmmo; reloading=false;}
  }

  if(frame%40===0) spawnMissile();

  // Bullets
  for(let i=bullets.length-1;i>=0;i--){ const b=bullets[i]; b.x+=b.vx; b.y+=b.vy; b.draw(); if(b.y<-20) bullets.splice(i,1);}

  // Missiles
  for(let i=missiles.length-1;i>=0;i--){
    const m=missiles[i];
    const dx=plane.x-m.x, dy=plane.y-m.y; const dist=Math.hypot(dx,dy);
    if(dist>40){
      const desiredAngle=Math.atan2(dy,dx);
      const desiredVx=Math.cos(desiredAngle)*m.speed;
      const desiredVy=Math.sin(desiredAngle)*m.speed;
      m.vx+=(desiredVx-m.vx)*m.homingStrength;
      m.vy+=(desiredVy-m.vy)*m.homingStrength;
    }
    m.x+=m.vx; m.y+=m.vy; m.speed=Math.hypot(m.vx,m.vy); m.angle=Math.atan2(m.vy,m.vx);
    m.draw();

    // Collision
    const planeRadius=Math.max(plane.w,plane.h)/2-2;
    const missileRadius=Math.max(m.w,m.h)/2-1;
    if(dist<planeRadius+missileRadius){
      spawnExplosion(m.x,m.y,'#ff4444'); missiles.splice(i,1); health--; if(health<=0){ alert('Game Over! Score: '+score); location.reload();} continue;
    }

    // Bullet collision
    let destroyed=false;
    for(let j=bullets.length-1;j>=0;j--){ const b=bullets[j]; if(Math.hypot(b.x-m.x,b.y-m.y)<(Math.max(m.w,m.h)/2+Math.max(b.w,b.h)/2)){ bullets.splice(j,1); missiles.splice(i,1); destroyed=true; score+=10; spawnExplosion(m.x,m.y,'#ffcc44'); break;}}
    if(destroyed) continue;

    // Missile passed plane
    if(m.y>plane.y+plane.h/2+6){score+=5;spawnExplosion(m.x,m.y,'#ffaa33');missiles.splice(i,1);}
  }

  // Particles
  for(let i=particles.length-1;i>=0;i--){ const p=particles[i]; p.x+=p.vx; p.y+=p.vy; p.vy+=0.06; p.life--; p.draw(); if(p.life<=0) particles.splice(i,1);}

  drawHUD();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
