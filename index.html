<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plane Dodging Missiles (8-bit)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <style>
    :root {
      --bg: #000;
      --panel: #111;
      --accent: #00d0ff;
      --text: #fff;
      --muted: #bbb;
    }
    body {
      margin: 0;
      background: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    canvas {
      image-rendering: pixelated;
      border: 4px solid #222;
      background: #000;
      box-shadow: 0 0 32px #111;
    }

    /* HUD */
    #hud {
      position: absolute;
      top: 8px;
      left: 12px;
      right: 12px;
      display: flex;
      justify-content: space-between;
      font-family: monospace;
      font-size: 14px;
      color: var(--text);
      text-shadow: 1px 1px #000;
      z-index: 10;
      pointer-events: none;
    }

    /* Start screen */
    #overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      z-index: 20;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.95) 60%, rgba(0,0,0,1) 100%);
      font-family: monospace;
      color: var(--text);
    }
    .panel {
      width: 280px;
      max-width: 90vw;
      background: var(--panel);
      border: 2px solid #333;
      box-shadow: 0 0 24px #000;
      padding: 16px;
      text-align: center;
    }
    .title {
      font-size: 20px;
      letter-spacing: 2px;
      color: var(--accent);
      text-shadow: 0 0 8px rgba(0,208,255,0.35);
      margin-bottom: 8px;
    }
    .subtitle {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 12px;
    }
    .controls {
      font-size: 12px;
      color: var(--text);
      margin: 8px 0 16px;
      text-align: left;
    }
    .blink {
      color: var(--accent);
      margin-top: 8px;
      animation: blink 1s infinite steps(2, start);
    }
    @keyframes blink { 50% { opacity: 0; } }
    .btn {
      display: inline-block;
      font-family: monospace;
      font-size: 14px;
      padding: 8px 16px;
      background: #1a1a1a;
      color: var(--text);
      border: 2px solid #444;
      cursor: pointer;
      box-shadow: 0 0 12px #000;
    }
    .btn:hover { border-color: var(--accent); color: var(--accent); }

    /* End screen */
    #endScreen {
      position: absolute;
      inset: 0;
      display: none;
      place-items: center;
      z-index: 20;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.95) 60%, rgba(0,0,0,1) 100%);
      font-family: monospace;
      color: var(--text);
    }
    #endPanel {
      width: 280px;
      max-width: 90vw;
      background: var(--panel);
      border: 2px solid #333;
      box-shadow: 0 0 24px #000;
      padding: 16px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Start screen -->
  <div id="overlay">
    <div class="panel">
      <div class="title">Missile Dodger</div>
      <div class="subtitle">An 8-bit survival mini-game</div>
      <div class="controls">
        - Move: Arrow Left/Right<br>
        - Shoot: Space<br>
        - Power-ups: Shield, Rapid, Double<br>
        - Missiles stop homing close to you
      </div>
      <button id="startBtn" class="btn">Start</button>
      <div class="blink">Press Space or Enter to start</div>
    </div>
  </div>

  <!-- End screen -->
  <div id="endScreen">
    <div id="endPanel">
      <div id="endScore" style="font-size:14px;margin-bottom:12px;"></div>
      <button id="restartBtn" class="btn">Restart</button>
    </div>
  </div>

  <!-- HUD -->
  <div id="hud">
    <div id="score"></div>
    <div id="ammo"></div>
    <div id="lives"></div>
  </div>

  <canvas id="game" width="320" height="480" tabindex="0" aria-label="Game canvas"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// Palette
const COLORS = {
  plane: ['#e0e0e0','#0077ff','#ff0000'],
  missile: ['#ff2222','#cccccc','#222222'],
  bullet: '#ffff88'
};

// Game state
let started=false, gameOver=false;
let frame=0, score=0, lives=3;
let highScore=Number(localStorage.getItem('highScore')||0);

// Plane
const plane={x:W/2,y:H-60,w:24,h:20,speed:3.8,vx:0,angle:0,invincible:0,doubleShot:0,
  draw(){
    ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.angle);
    if(this.invincible>0) ctx.globalAlpha=0.6;
    ctx.fillStyle=COLORS.plane[0];ctx.fillRect(-4,-8,8,16);
    ctx.fillStyle=COLORS.plane[1];ctx.fillRect(-12,2,24,4);
    ctx.fillStyle=COLORS.plane[2];ctx.fillRect(-2,-14,4,6);
    ctx.restore();ctx.globalAlpha=1;
  }
};

// Bullets
const bullets=[]; let bulletCooldown=0; let bulletCooldownMax=12;
function makeBullet(x,y){return{x,y,vx:0,vy:-6.5,w:2,h:6,draw(){ctx.fillStyle=COLORS.bullet;ctx.fillRect(this.x-this.w/2,this.y-this.h/2,this.w,this.h);}};}
function shoot(){
  if(bulletCooldown<=0&&!gameOver){
    if(plane.doubleShot>0){
      bullets.push(makeBullet(plane.x-6,plane.y-14));
      bullets.push(makeBullet(plane.x+6,plane.y-14));
    } else {
      bullets.push(makeBullet(plane.x,plane.y-14));
    }
    bulletCooldown=bulletCooldownMax;
  }
}

// Missiles
const missiles=[];
function spawnMissile(){
  const r=Math.random(); const side=r<0.34?'left':(r<0.67?'right':'rear');
  let m={w:8,h:20,homing:true};
  if(side==='left'){m.x=-30;m.y=40+Math.random()*(H-120);m.vx=3.5+Math.random()*1.5;m.vy=(Math.random()-0.2)*1.5;}
  else if(side==='right'){m.x=W+30;m.y=40+Math.random()*(H-120);m.vx=-3.5-Math.random()*1.5;m.vy=(Math.random()-0.2)*1.5;}
  else{m.x=24+Math.random()*(W-48);m.y=-40;m.vx=(Math.random()-0.5)*1.2;m.vy=3.8+Math.random()*1.7;}
  m.speed=Math.hypot(m.vx,m.vy); m.angle=Math.atan2(m.vy,m.vx);
  m.homingStrength=0.02+Math.random()*0.03+frame/50000; // difficulty scaling
  m.draw=function(){
    ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.angle+Math.PI/2);
    ctx.fillStyle=COLORS.missile[1];ctx.fillRect(-4,-8,8,16);
    ctx.fillStyle=COLORS.missile[0];ctx.fillRect(-2,-14,4,6);
    ctx.fillStyle=COLORS.missile[2];ctx.fillRect(-1,-16,2,2);
    ctx.restore();
  };
  missiles.push(m);
}

// Particles
const particles=[];
function spawnExplosion(x,y,color='#ffcc44'){
  for(let i=0;i<8;i++){
    const a=Math.random()*Math.PI*2; const s=1+Math.random()*2.5;
    particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:30+Math.random()*20,
      draw(){ctx.fillStyle=color;ctx.fillRect(this.x-1,this.y-1,2,2);}
    });
  }
}

// Power-ups
const powerUps=[];
function spawnPowerUp(x,y){
  const types=['shield','rapid','double'];
  const type=types[Math.floor(Math.random()*types.length)];
  powerUps.push({x,y,type,w:12,h:12,life:600});
}
function drawPowerUps(){
  for(let i=powerUps.length-1;i>=0;i--){
    const p=powerUps[i];
    ctx.fillStyle = p.type==='shield' ? '#44f' : (p.type==='rapid' ? '#4f4' : '#ff4');
    ctx.fillRect(p.x-6,p.y-6,12,12);
    p.y += 1; p.life--;
    if (p.life<=0){ powerUps.splice(i,1); continue; }
    if (Math.abs(p.x-plane.x)<14 && Math.abs(p.y-plane.y)<14){
      if (p.type==='shield') plane.invincible=300;
      if (p.type==='rapid') bulletCooldownMax=6;
      if (p.type==='double') plane.doubleShot=600;
      powerUps.splice(i,1);
    }
  }
}

// Starfield
const stars=Array.from({length:80},()=>({x:Math.random()*W,y:Math.random()*H,s:Math.random()*2+1}));
function drawBackground(){
  ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#fff';
  for(let star of stars){
    ctx.fillRect(star.x,star.y,star.s,star.s);
    star.y += star.s*0.5;
    if(star.y>H){ star.y=0; star.x=Math.random()*W; }
  }
}

// Controls
let left=false,right=false,shooting=false;
function startGame(){
  if (started) return;
  started=true;
  document.getElementById('overlay').style.display='none';
  // Focus canvas so key events work reliably
  canvas.focus();
  loop();
}
document.getElementById('startBtn').addEventListener('click', startGame);

window.addEventListener('keydown',e=>{
  if(!started && (e.code==='Space' || e.code==='Enter')){ startGame(); return; }
  if(e.key==='ArrowLeft') left=true;
  if(e.key==='ArrowRight') right=true;
  if(e.code==='Space'){ shooting=true; shoot(); }
});
window.addEventListener('keyup',e=>{
  if(e.key==='ArrowLeft') left=false;
  if(e.key==='ArrowRight') right=false;
  if(e.code==='Space') shooting=false;
});

// HUD
const scoreEl=document.getElementById('score');
const livesEl=document.getElementById('lives');
const ammoEl=document.getElementById('ammo');
function updateHUD(){
  scoreEl.textContent='Score: '+score;
  livesEl.textContent='â™¥'.repeat(lives);
  ammoEl.textContent='Ammo: '+(bulletCooldown<=0?'Ready':(bulletCooldownMax-bulletCooldown));
}

// End screen and restart
const endScreen=document.getElementById('endScreen');
const endScoreEl=document.getElementById('endScore');
document.getElementById('restartBtn').addEventListener('click', restartGame);

function endGame(){
  gameOver=true;
  highScore=Math.max(score, highScore);
  localStorage.setItem('highScore', highScore);
  endScoreEl.textContent='Score: '+score+'\nHigh Score: '+highScore;
  endScreen.style.display='grid';
}
function restartGame(){
  endScreen.style.display='none';
  gameOver=false; started=true;
  frame=0; score=0; lives=3;
  bullets.length=0; missiles.length=0; particles.length=0; powerUps.length=0;
  plane.x=W/2; plane.y=H-60; plane.vx=0; plane.angle=0; plane.invincible=0; plane.doubleShot=0;
  bulletCooldown=0; bulletCooldownMax=12;
  updateHUD();
  canvas.focus();
  loop();
}

// Main loop
function loop(){
  if (gameOver) return;
  frame++;
  drawBackground();

  // Movement
  plane.vx=0;
  if(left) plane.vx=-plane.speed;
  if(right) plane.vx=plane.speed;
  plane.x+=plane.vx;
  plane.x=Math.max(20,Math.min(W-20,plane.x));
  const targetAngle=-plane.vx*0.06;
  plane.angle+=(targetAngle-plane.angle)*0.18;

  // Shooting
  if(bulletCooldown>0) bulletCooldown--;
  if(shooting && bulletCooldown<=0) shoot();

  // Spawn missiles
  const spawnInterval=Math.max(18,60-Math.floor(frame/700));
  if(frame%spawnInterval===0) spawnMissile();

  // Plane draw (subtle flashing via alpha)
  if(plane.invincible>0) plane.invincible--;
  plane.draw();

  // Bullets
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];
    b.x+=b.vx; b.y+=b.vy; b.draw();
    if(b.y<-20 || b.x<-40 || b.x>W+40) bullets.splice(i,1);
  }

  // Missiles
  for(let i=missiles.length-1;i>=0;i--){
    const m=missiles[i];
    const dx=plane.x-m.x, dy=plane.y-m.y;
    const dist=Math.hypot(dx,dy);

    // Homing until 40px, then straight
    if(m.homing && dist>40){
      const desiredAngle=Math.atan2(dy,dx);
      const desiredVx=Math.cos(desiredAngle)*m.speed;
      const desiredVy=Math.sin(desiredAngle)*m.speed;
      m.vx += (desiredVx - m.vx)*m.homingStrength;
      m.vy += (desiredVy - m.vy)*m.homingStrength;
    } else if (m.homing && dist<=40){
      m.homing=false; // lock current direction
    }

    m.x+=m.vx; m.y+=m.vy;
    m.speed=Math.hypot(m.vx,m.vy);
    m.angle=Math.atan2(m.vy,m.vx);
    m.draw();

    // Bullet collision
    let destroyed=false;
    for(let j=bullets.length-1;j>=0;j--){
      const b=bullets[j];
      const dx2=b.x-m.x, dy2=b.y-m.y;
      if(Math.hypot(dx2,dy2) < (Math.max(m.w,m.h)/2 + Math.max(b.w,b.h)/2)){
        bullets.splice(j,1);
        missiles.splice(i,1);
        destroyed=true;
        score+=10; updateHUD();
        spawnExplosion(m.x,m.y,'#ffcc44');
        if(Math.random()<0.15) spawnPowerUp(m.x,m.y);
        break;
      }
    }
    if(destroyed) continue;

    // Plane collision
    const planeRadius=Math.max(plane.w,plane.h)/2 - 2;
    const missileRadius=Math.max(m.w,m.h)/2 - 1;
    if(dist < planeRadius + missileRadius){
      if(plane.invincible>0){
        missiles.splice(i,1);
        spawnExplosion(m.x,m.y,'#ffaa33');
        score+=5; updateHUD();
      } else {
        loseLife();
        return;
      }
    }
  }

  // Power-ups
  drawPowerUps();

  // Particles
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx; p.y+=p.vy; p.vy+=0.06;
    p.life-=1; p.draw();
    if(p.life<=0) particles.splice(i,1);
  }

  // Cleanup off-screen missiles
  for(let i=missiles.length-1;i>=0;i--){
    const m=missiles[i];
    if(m.x<-120 || m.x>W+120 || m.y>H+120 || m.y<-240) missiles.splice(i,1);
  }

  // Reset rapid fire slowly, tick down double shot
  if(bulletCooldownMax<12) bulletCooldownMax++;
  if(plane.doubleShot>0) plane.doubleShot--;

  updateHUD();
  requestAnimationFrame(loop);
}

function loseLife(){
  lives--; updateHUD();
  if(lives<=0){ endGame(); }
  else { plane.invincible=90; }
}

// Initial HUD and keep overlay visible until start
updateHUD();
</script>
</body>
</html>
