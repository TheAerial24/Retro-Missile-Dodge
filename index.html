<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Plane Dodger</title>
  <style>
    body { margin:0; background:#000; display:flex; align-items:center; justify-content:center; height:100vh; overflow:hidden; }
    canvas { image-rendering:pixelated; border:4px solid #222; background:#000; box-shadow:0 0 32px #111; }
    #endScreen {
      position:absolute; inset:0; display:none; justify-content:center; align-items:center;
      background:rgba(0,0,0,0.9); z-index:20; font-family:monospace; color:#fff;
    }
    .panel { background:#111; border:2px solid #333; padding:20px; text-align:center; box-shadow:0 0 24px #000; }
    .title { font-size:20px; color:#00d0ff; margin-bottom:12px; }
    .btn { margin-top:12px; font-family:monospace; font-size:14px; padding:8px 16px; background:#1a1a1a; color:#fff; border:2px solid #444; cursor:pointer; }
    .btn:hover { border-color:#00d0ff; color:#00d0ff; }
  </style>
</head>
<body>
  <div id="endScreen">
    <div class="panel">
      <div id="endScore" style="margin-bottom:12px;"></div>
      <button id="restartBtn" class="btn">Restart</button>
    </div>
  </div>
  <canvas id="game" width="320" height="480"></canvas>

<script>
const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');
const W=canvas.width,H=canvas.height;
const COLORS={plane:['#e0e0e0','#0077ff','#ff0000'],missile:['#ff2222','#ccc','#222'],bullet:'#ff0'};
let gameOver=false,frame=0,score=0,lives=3,highScore=+localStorage.getItem('highScore')||0;
const plane={x:W/2,y:H-60,w:24,h:20,speed:3.8,vx:0,angle:0,invincible:0,doubleShot:0,
  draw(){ctx.save();ctx.translate(this.x,this.y);ctx.rotate(this.angle);if(this.invincible>0)ctx.globalAlpha=0.6;
    ctx.fillStyle=COLORS.plane[0];ctx.fillRect(-4,-8,8,16);
    ctx.fillStyle=COLORS.plane[1];ctx.fillRect(-12,2,24,4);
    ctx.fillStyle=COLORS.plane[2];ctx.fillRect(-2,-14,4,6);
    ctx.restore();ctx.globalAlpha=1;}};
const bullets=[];let bulletCooldown=0,bulletCooldownMax=12;
function makeBullet(x,y){return{x,y,vx:0,vy:-6.5,w:2,h:6,draw(){ctx.fillStyle=COLORS.bullet;ctx.fillRect(this.x-1,this.y-3,2,6);}};}
function shoot(){if(bulletCooldown<=0&&!gameOver){if(plane.doubleShot>0){bullets.push(makeBullet(plane.x-6,plane.y-14));bullets.push(makeBullet(plane.x+6,plane.y-14));}else bullets.push(makeBullet(plane.x,plane.y-14));bulletCooldown=bulletCooldownMax;}}
const missiles=[];function spawnMissile(){let m={x:Math.random()*W,y:-20,vx:(Math.random()-0.5)*1.2,vy:3+Math.random()*2,w:8,h:20,homing:true};m.speed=Math.hypot(m.vx,m.vy);m.angle=Math.atan2(m.vy,m.vx);m.homingStrength=0.03;missiles.push(m);}
const particles=[];function spawnExplosion(x,y){for(let i=0;i<6;i++){const a=Math.random()*6.28,s=1+Math.random()*2;particles.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:30});}}
const stars=Array.from({length:60},()=>({x:Math.random()*W,y:Math.random()*H,s:Math.random()*2+1}));
function drawBackground(){ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);ctx.fillStyle='#fff';for(let star of stars){ctx.fillRect(star.x,star.y,star.s,star.s);star.y+=star.s*0.5;if(star.y>H){star.y=0;star.x=Math.random()*W;}}}
function drawHUD(){ctx.fillStyle='#111';ctx.fillRect(8,8,120,40);ctx.strokeStyle='#444';ctx.strokeRect(8,8,120,40);
  ctx.fillStyle='#fff';ctx.font='12px monospace';ctx.fillText('Score:'+score,14,22);
  ctx.fillStyle='red';ctx.fillText('â™¥'.repeat(lives),14,36);
  ctx.fillStyle='#333';ctx.fillRect(70,28,50,8);
  let ammoRatio=1-(bulletCooldown/bulletCooldownMax);ctx.fillStyle='#ff0';ctx.fillRect(70,28,50*ammoRatio,8);
  ctx.strokeStyle='#666';ctx.strokeRect(70,28,50,8);}
let left=false,right=false,shooting=false;
window.addEventListener('keydown',e=>{if(e.key==='ArrowLeft')left=true;if(e.key==='ArrowRight')right=true;if(e.code==='Space'){shooting=true;shoot();}});
window.addEventListener('keyup',e=>{if(e.key==='ArrowLeft')left=false;if(e.key==='ArrowRight')right=false;if(e.code==='Space')shooting=false;});
function loop(){if(gameOver)return;frame++;drawBackground();
  plane.vx=0;if(left)plane.vx=-plane.speed;if(right)plane.vx=plane.speed;plane.x+=plane.vx;plane.x=Math.max(20,Math.min(W-20,plane.x));
  plane.angle+=( -plane.vx*0.06 - plane.angle)*0.18;if(bulletCooldown>0)bulletCooldown--;if(shooting&&bulletCooldown<=0)shoot();
  if(frame%50===0)spawnMissile();if(plane.invincible>0)plane.invincible--;plane.draw();
  for(let i=bullets.length-1;i>=0;i--){let b=bullets[i];b.x+=b.vx;b.y+=b.vy;b.draw();if(b.y<-20)bullets.splice(i,1);}
  for(let i=missiles.length-1;i>=0;i--){let m=missiles[i];let dx=plane.x-m.x,dy=plane.y-m.y,dist=Math.hypot(dx,dy);
    if(m.homing&&dist>40){let da=Math.atan2(dy,dx);let dvx=Math.cos(da)*m.speed,dvy=Math.sin(da)*m.speed;m.vx+=(dvx-m.vx)*m.homingStrength;m.vy+=(dvy-m.vy)*m.homingStrength;}else if(m.homing&&dist<=40){m.homing=false;}
    m.x+=m.vx;m.y+=m.vy;m.angle=Math.atan2(m.vy,m.vx);ctx.save();ctx.translate(m.x,m.y);ctx.rotate(m.angle+Math.PI/2);ctx.fillStyle='#ccc';ctx.fillRect(-4,-8,8,16);ctx.fillStyle='#f22';ctx.fillRect(-2,-14,4,6);ctx.restore();
    for(let j=bullets.length-1;j>=0;j--){let b=bullets[j];if(Math.hypot(b.x-m.x,b.y-m.y)<10){bullets.splice(j,1);missiles.splice(i,1);score+=10;spawnExplosion(m.x,m.y);break;}}
    if(Math.hypot(m.x-plane.x,m.y-plane.y)<16){if(plane.invincible>0){missiles.splice(i,1);spawnExplosion(m.x,m.y);}else{lives--;plane.invincible=90;if(lives<=0){endGame();return;}}}}
  for(let i=particles.length-1;i>=0;i--){let p=particles[i];p.x+=p.vx;p.y+=p.vy;p.life--;ctx.fillStyle='#f80';ctx.fillRect(p.x,p.y,2,2);if(p.life<=0)particles.splice(i,1);}
  drawHUD();
  requestAnimationFrame(loop);}
function endGame(){gameOver=true;document.getElementById('endScreen').style.display='flex';
  document.getElementById('endScore').textContent=`Score: ${score}`;if(score>highScore){highScore=score;localStorage.setItem('highScore',highScore);}}
document.getElementById('restartBtn').onclick=()=>{location.reload();};
// Start immediately
loop();
</script>
</body>
</html>
